<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Artwork Details</title>
  <link rel="stylesheet" href="index.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
    .art-container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .main-image { width: 100%; max-height: 400px; object-fit: contain; border-radius: 8px; }
    .details { margin-top: 20px; }
    .details h2 { margin: 10px 0; font-size: 28px; }
    .details p { margin: 6px 0; font-size: 16px; }
    .price { font-size: 22px; font-weight: bold; color: #222; margin: 10px 0; }
    .stock { color: green; font-weight: bold; }
    .gallery { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .gallery img { width: 120px; height: 120px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd; }
    .videos { margin-top: 20px; }
    .videos video { width: 100%; max-height: 400px; border-radius: 6px; margin-bottom: 15px; }
    .back { display: inline-block; margin-bottom: 20px; text-decoration: none; color: #333; font-weight: bold; }
    .back:hover { text-decoration: underline; }
    .order-btn { display: inline-block; margin-top: 20px; padding: 12px 25px; background: #25D366; color: #fff; font-size: 18px; font-weight: bold; border-radius: 6px; text-decoration: none; transition: 0.3s; }
    .order-btn:hover { background: #1da851; }
    .email-btn { display: inline-block; margin-top: 20px; padding: 12px 25px; background: #2b6cb0; color: #fff; font-size: 16px; font-weight: bold; border-radius: 6px; text-decoration: none; transition: 0.3s; margin-left: 12px; }
    .email-btn:hover { background: #225a97; }

    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; }
    .modal.open { display:flex; }
    .modal-card { width: 95%; max-width: 520px; background:#fff; border-radius:10px; padding:20px; }
    .modal-card h3 { margin-top:0; }
    .form-row { display:flex; gap:10px; }
    .form-row > div { flex:1; }
    input[type="text"], input[type="email"], textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; }
    textarea { min-height:120px; resize:vertical; }
    .modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
    .btn { padding:10px 16px; border:none; border-radius:6px; cursor:pointer; }
    .btn.secondary { background:#eee; }
    .btn.primary { background:#2b6cb0; color:#fff; }
    .small { color:#666; font-size:12px; margin-top:6px;}
    .success { color: green; font-weight: bold; margin-top: 10px; }
    .error { color: crimson; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <a href="index.html" class="back">‚¨Ö Back to Home</a>

  <div class="art-container" id="artDetails"></div>

  <!-- Email Modal -->
  <div id="emailModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Contact via Email</h3>
      <form id="emailForm" enctype="multipart/form-data">
        <div class="form-row">
          <div>
            <label>Your Name *</label>
            <input type="text" name="name" id="c_name" required />
          </div>
          <div>
            <label>Your Email *</label>
            <input type="email" name="email" id="c_email" required />
          </div>
        </div>
        <div>
          <label>Subject *</label>
          <input type="text" name="subject" id="c_subject" required />
        </div>
        <div>
          <label>Message *</label>
          <textarea name="message" id="c_message" placeholder="Write your message..." required></textarea>
        </div>
        <div>
          <label>Attachments (optional, up to 3)</label>
          <input type="file" name="attachments" id="c_files" multiple accept="image/*,application/pdf" />
          <div class="small">Max 10MB total per file.</div>
        </div>

        <input type="hidden" name="artworkId" id="c_artworkId" />
        <input type="hidden" name="artworkTitle" id="c_artworkTitle" />

        <div class="modal-actions">
          <button type="button" class="btn secondary" id="closeModalBtn">Cancel</button>
          <button type="submit" class="btn primary">Send Email</button>
        </div>
        <div id="emailMsg"></div>

       
      </form>
    </div>
  </div>

  <script>
    const WHATSAPP_NUMBER = "917385184575";

    function openEmailModal() {
      document.getElementById("emailModal").classList.add("open");
      document.getElementById("emailModal").setAttribute("aria-hidden", "false");
    }
    function closeEmailModal() {
      document.getElementById("emailModal").classList.remove("open");
      document.getElementById("emailModal").setAttribute("aria-hidden", "true");
    }
    document.getElementById("closeModalBtn").addEventListener("click", closeEmailModal);

    async function loadArtworkDetails() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) return;

      try {
        const res = await fetch("/api/artworks");
        const artworks = await res.json();
        const art = artworks.find(a => a._id === id);

        if (!art) {
          document.getElementById("artDetails").innerHTML = "<p>Artwork not found.</p>";
          return;
        }

        document.getElementById("c_artworkId").value = art._id;
        document.getElementById("c_artworkTitle").value = art.title;
        document.getElementById("c_subject").value = `Inquiry: ${art.title}`;

        const artworkUrl = window.location.href;
        const waLink =
          `https://wa.me/7385184575?text=` +
          encodeURIComponent(
            `Hello, I am interested in "${art.title}" (Price: ‚Çπ${art.price})\nArtwork Link: ${artworkUrl}`
          );

        document.getElementById("artDetails").innerHTML = `
          <img class="main-image" src="${art.mainImage}" alt="${art.title}">
          <div class="details">
            <h2>${art.title}</h2>
            <p class="price">‚Çπ${art.price}</p>
            <p class="stock">Stock Available: ${art.stock}</p>
            <p><strong>Description:</strong> ${art.description}</p>
            <p><strong>Material:</strong> ${art.material}</p>
            <p><strong>Weight:</strong> ${art.weight} g</p>
            <p><strong>Diameter:</strong> ${art.diameter} mm</p>
            <p><strong>Color Finish:</strong> ${art.colorFinish}</p>
            <p><strong>Coin Type:</strong> ${art.coinType}</p>

            <a href="${waLink}" target="_blank" class="order-btn">üì≤ Order Now on WhatsApp</a>
            <a href="javascript:void(0)" class="email-btn" id="emailBtn">‚úâÔ∏è Email Us</a>
             <!-- New Wishlist & Cart buttons -->
<button onclick="addToWishlist('${art._id}', '${art.title}', '${art.price}', '${art.mainImage}')" class="email-btn" style="background:#e63946;">‚ù§Ô∏è Add to Wishlist</button>
<button onclick="addToCart('${art._id}', '${art.title}', '${art.price}', '${art.mainImage}')" class="email-btn" style="background:#38a169;">üõí Add to Cart</button>

          </div>

          ${art.additionalImages && art.additionalImages.length > 0 ? `
            <h3>More Images</h3>
            <div class="gallery">
              ${art.additionalImages.map(img => `<img src="${img}" alt="Additional image">`).join("")}
            </div>
          ` : ""}

          ${art.videos && art.videos.length > 0 ? `
            <h3>Videos</h3>
            <div class="videos">
              ${art.videos.map(v => `<video controls src="${v}"></video>`).join("")}
            </div>
          ` : ""}
        `;

        document.getElementById("emailBtn").addEventListener("click", openEmailModal);
      } catch (err) {
        console.error("Error loading artwork:", err);
      }
    }

    // Email form submit
    document.getElementById("emailForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = document.getElementById("emailMsg");
      msg.className = "";
      msg.textContent = "Sending...";

      try {
        const fd = new FormData(e.target);
        const files = document.getElementById("c_files").files;
        for (const f of files) fd.append("attachments", f);

        const res = await fetch("http://localhost:5001/api/inquiries", {
          method: "POST",
          body: fd,
        });
        const data = await res.json();

        if (data.success) {
          msg.textContent = "‚úÖ Email sent successfully! Please check your inbox.";
          msg.className = "success";
          e.target.reset();
          setTimeout(closeEmailModal, 1200);
        } else {
          msg.textContent = "‚ùå " + (data.error || "Failed to send email");
          msg.className = "error";
        }
      } catch (err) {
        console.error(err);
        msg.textContent = "‚ùå Server error";
        msg.className = "error";
      }
    });


    function addToWishlist(id, title, price, image) {
  let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
  if (!wishlist.find(item => item.id === id)) {
    wishlist.push({ id, title, price, image });
    localStorage.setItem("wishlist", JSON.stringify(wishlist));
    alert("‚ù§Ô∏è Added to Wishlist!");
  } else {
    alert("Already in Wishlist");
  }
}

function addToCart(id, title, price, image) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let item = cart.find(item => item.id === id);
  if (item) {
    item.qty += 1; // increase quantity
  } else {
    cart.push({ id, title, price, image, qty: 1 });
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("üõí Added to Cart!");
}


    loadArtworkDetails();
  </script>
</body>
</html>
